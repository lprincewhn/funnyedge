<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>监控分析 on Funny Edge Workshop</title><link>http://funnyedge.svhw.tech/20_monitor/</link><description>Recent content in 监控分析 on Funny Edge Workshop</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Tue, 12 Apr 2022 14:13:47 +0800</lastBuildDate><atom:link href="http://funnyedge.svhw.tech/20_monitor/index.xml" rel="self" type="application/rss+xml"/><item><title>CloudFront指标</title><link>http://funnyedge.svhw.tech/20_monitor/10_aws_metrics/</link><pubDate>Tue, 12 Apr 2022 14:32:23 +0800</pubDate><guid>http://funnyedge.svhw.tech/20_monitor/10_aws_metrics/</guid><description>在CloudFront控制台</description></item><item><title>在CloudWatch查看指标</title><link>http://funnyedge.svhw.tech/20_monitor/10_cloudwatch/</link><pubDate>Tue, 12 Apr 2022 14:32:23 +0800</pubDate><guid>http://funnyedge.svhw.tech/20_monitor/10_cloudwatch/</guid><description>CloudWatch是AWS的统一可观测性平台，可在此处对所有AWS服务和资源进行监控。
CloudFront的指标会被送到“弗吉尼亚北部”的CloudWatch当中，因此通过以下URL打开CloudWatch控制台： https://console.aws.amazon.com/cloudwatch/home?region=us-east-1#
创建CloudWatch控制面板 AWS已经提供了一些预定义的控制面板，这些控制面板在”自动控制面板“中，用户可以根据自己需求创建”自定义控制面板“，切换至”自定义控制面板“标签页，点击”创建控制面板“，在弹出的对话框中输入控制面板名称创建控制面板。
在控制面板中添加指标面板 点击“添加小组件“按钮，选择”线形图“和“指标”</description></item><item><title>自定义指标</title><link>http://funnyedge.svhw.tech/20_monitor/20_customeized_metrics/</link><pubDate>Tue, 12 Apr 2022 14:32:23 +0800</pubDate><guid>http://funnyedge.svhw.tech/20_monitor/20_customeized_metrics/</guid><description>&amp;lt;敬请期待&amp;gt;</description></item><item><title>使用Athena分析访问日志</title><link>http://funnyedge.svhw.tech/20_monitor/30_access_log/</link><pubDate>Tue, 12 Apr 2022 14:32:23 +0800</pubDate><guid>http://funnyedge.svhw.tech/20_monitor/30_access_log/</guid><description>1.（可选）创建用于存储CloudFront日志的存储桶 如果还没有用于存储日志的S3桶，按照以下步骤创建，如果要使用已有桶，可跳过该步骤。
1.1 使用以下URL打开S3控制台
https://s3.console.aws.amazon.com/s3/buckets 1.2 输入存储桶名称和选择区域，其余参数保留默认配置 1.3 为日志桶设置生命周期规则，定期删除旧文件。
使用Athena查询时费用和扫描的数据量有关，因此定期删除过期文件，可控制查询成本以及提高查询速度。
在S3桶的详情页面切换到“管理”标签页，点击“创建生命周期规则” 参考以下截图进行配置: 2. 打开CloudFront分配标准日志 2.1 点击分配ID进入详情页，确认标准日志已经打开 2.2 点击“编辑”按钮进入编辑页面，启用标准日志，确认或设置日志存储路径。 3. 通过Athena使用SQL分析日志 通过以下链接打开Athena控制台, 切换到和日志存储桶相同的区域
https://console.aws.amazon.com/athena/home
3.1 (可选) 如果是第一次使用Athena，需要先设置一个S3桶用于存储Athena查询的结果，步骤如下图： 3.2 在Athena查询编辑器 3.3 运行建表语句
在查询编辑器中运行以下建表语句，注意需要将其中的LOCATION修改为存储CloudFront标准日志的路径。
CREATE EXTERNAL TABLE IF NOT EXISTS default.cloudfront_logs ( `date` DATE, time STRING, location STRING, bytes BIGINT, request_ip STRING, method STRING, host STRING, uri STRING, status INT, referrer STRING, user_agent STRING, query_string STRING, cookie STRING, result_type STRING, request_id STRING, host_header STRING, request_protocol STRING, request_bytes BIGINT, time_taken FLOAT, xforwarded_for STRING, ssl_protocol STRING, ssl_cipher STRING, response_result_type STRING, http_version STRING, fle_status STRING, fle_encrypted_fields INT, c_port INT, time_to_first_byte FLOAT, x_edge_detailed_result_type STRING, sc_content_type STRING, sc_content_len BIGINT, sc_range_start BIGINT, sc_range_end BIGINT ) ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t' LOCATION 's3://&amp;lt;CloudFront_standard_log_bucket_name/prefix/&amp;gt;' TBLPROPERTIES ( 'skip.</description></item></channel></rss>